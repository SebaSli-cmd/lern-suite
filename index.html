<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ultimate Lern-Suite V25.0 (Full)</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0052cc">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/180/brain--v1.png">

    <style>
        :root {
            --primary: #0052cc;
            --primary-dark: #003d99;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #0f172a;
            --text-muted: #475569;
            --border: #cbd5e1;
            --input-bg: #ffffff;
            --header-cell-bg: #f1f5f9;
            --hover-bg: #e2e8f0;
            --success: #15803d;
            --danger: #b91c1c;
            --warning-bg: #fff7ed;
            --warning-text: #9a3412;
            --lf-badge-bg: #e0f2fe;
            --lf-badge-text: #0369a1;
            --ap-badge-bg: #f3e8ff;
            --ap-badge-text: #6b21a8;
        }

        body.dark-mode {
            --primary: #60a5fa;
            --primary-dark: #3b82f6;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f8fafc;
            --text-muted: #cbd5e1;
            --border: #475569;
            --input-bg: #020617;
            --header-cell-bg: #1e293b;
            --hover-bg: #334155;
            --warning-bg: #451a03;
            --warning-text: #fb923c;
            --lf-badge-bg: #0c4a6e;
            --lf-badge-text: #bae6fd;
            --ap-badge-bg: #4c1d95;
            --ap-badge-text: #e9d5ff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 15px; 
            padding-bottom: 140px; 
            line-height: 1.5;
            -webkit-tap-highlight-color: transparent;
        }

        input, select, textarea { font-size: 16px !important; }

        /* --- Header --- */
        .suite-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 20px;
        }

        .header-top { display: flex; flex-direction: column; gap: 15px; }

        @media (min-width: 600px) {
            .header-top { flex-direction: row; justify-content: space-between; align-items: center; }
        }

        .header-info h1 { margin: 0; font-size: 1.5rem; }
        .header-info p { margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9rem; }

        .header-controls-wrapper { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

        .streak-badge {
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            display: flex; align-items: center; gap: 5px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .btn-dark-mode, .btn-exam-action {
            background: rgba(255,255,255,0.2);
            border: none; color: white;
            width: 44px; height: 44px;
            border-radius: 10px;
            font-size: 1.2rem;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        
        .exam-control-group {
            background: rgba(255,255,255,0.15);
            padding: 8px; border-radius: 10px;
            flex-grow: 1;
        }
        .exam-controls { display: flex; gap: 8px; }
        #examSelect { 
            flex-grow: 1; padding: 8px; border-radius: 6px; border: none; font-weight: bold; color: #333;
            height: 44px;
        }

        /* Tabs */
        .tabs { display: flex; gap: 8px; overflow-x: auto; margin-top: 15px; padding-bottom: 5px; }
        .tab-btn {
            background: rgba(255,255,255,0.2); border: none; color: white; 
            padding: 12px 20px; border-radius: 25px;
            font-weight: 600; font-size: 0.95rem; white-space: nowrap;
        }
        .tab-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }

        /* --- Cockpit & Cards --- */
        .phase-display {
            background: var(--card-bg); padding: 15px; border-radius: 12px; border-left: 5px solid var(--primary);
            margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            font-size: 0.95rem;
        }
        .phase-badge { background: var(--primary); color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; margin-right: 8px; }

        .btn-magic {
            background: linear-gradient(135deg, #7c3aed, #db2777); color: white; border: none; 
            padding: 15px; border-radius: 12px; font-weight: bold; font-size: 1rem; width: 100%;
            margin-bottom: 20px; box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3);
            cursor: pointer;
        }

        .adhoc-toggle {
            background: var(--hover-bg); border: none; width: 100%; padding: 12px; border-radius: 8px;
            text-align: left; font-weight: 600; color: var(--text); margin-bottom: 10px;
            display: flex; align-items: center; gap: 10px; cursor: pointer;
        }
        
        .input-card {
            background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid var(--border);
            margin-bottom: 20px; display: none; gap: 10px;
            grid-template-columns: 1fr;
        }
        .input-card.open { display: grid; }
        @media (min-width: 600px) { .input-card.open { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); } }

        .form-group input, .form-group select {
            width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px;
            background: var(--input-bg); color: var(--text);
            box-sizing: border-box;
        }
        .btn-add {
            width: 100%; padding: 12px; background: var(--text); color: var(--bg); border: none; border-radius: 8px; font-weight: bold; cursor: pointer;
        }

        /* --- RESPONSIVE TABLES / LISTS --- */
        .task-table { width: 100%; border-collapse: collapse; }
        
        @media (max-width: 768px) {
            .task-table, .wbs-table, tbody, tr, td, th { display: block; width: 100%; box-sizing: border-box; }
            .task-table thead, .wbs-table thead { display: none; }
            
            .task-table tr, .wbs-table tr {
                background: var(--card-bg);
                margin-bottom: 15px;
                border-radius: 12px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                border: 1px solid var(--border);
                padding: 15px;
                position: relative;
            }

            .task-table td, .wbs-table td {
                padding: 5px 0;
                border: none;
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: right;
            }

            .wbs-table td::before {
                content: attr(data-label);
                font-weight: bold;
                color: var(--text-muted);
                font-size: 0.85rem;
                text-align: left;
                margin-right: 10px;
                min-width: 60px;
            }

            .wbs-table input, .wbs-table select { 
                width: 100%; text-align: right; border: none; background: transparent; padding: 5px; color: var(--text) !important;
            }
            .wbs-table input:focus { background: var(--input-bg); }
            
            .status-select { 
                width: auto; 
                padding: 6px 12px; 
                border-radius: 8px; 
                text-align-last: center; 
                border: none;
                font-weight: bold;
                -webkit-appearance: none;
                appearance: none;
            }
            
            .action-cell { justify-content: flex-end !important; margin-top: 10px; border-top: 1px solid var(--border) !important; padding-top: 10px !important;}
        }

        @media (min-width: 769px) {
            .task-table th, .wbs-table th { background: var(--header-cell-bg); padding: 15px; text-align: left; border-bottom: 2px solid var(--border); }
            .task-table td, .wbs-table td { padding: 12px; border-bottom: 1px solid var(--border); }
            .wbs-container { background: var(--card-bg); padding: 20px; border-radius: 12px; }
        }

        .score-badge { padding: 4px 8px; border-radius: 12px; font-weight: bold; font-size: 0.85rem; background: var(--hover-bg); border:1px solid var(--border); }
        .lf-badge { 
            padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; font-weight: bold; 
            background: var(--lf-badge-bg); color: var(--lf-badge-text); margin-left: 5px; text-transform: uppercase;
        }
        .ap-badge { 
            padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; font-weight: bold; 
            background: var(--ap-badge-bg); color: var(--ap-badge-text); margin-left: 5px; text-transform: uppercase;
        }

        .btn-check { font-size: 1.5rem; background: none; border: none; color: var(--border); cursor: pointer; padding: 10px; }
        .btn-check.checked { color: var(--success); }
        .task-done { text-decoration: line-through; opacity: 0.5; }

        .level-dots { font-size: 0.7rem; color: var(--primary); letter-spacing: 2px; margin-right: 5px;}
        .level-dots .active { opacity: 1; }
        .level-dots .inactive { opacity: 0.2; }

        /* Filter Row */
        .filter-row { display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap; background: var(--header-cell-bg); padding:10px; border-radius:12px; border:1px solid var(--border); }
        .filter-select { flex-grow:1; padding:10px; border-radius:8px; border:1px solid var(--border); background:var(--card-bg); color:var(--text); font-weight:bold;}

        /* Footer */
        .footer-tools {
            margin-top: 40px; text-align: center; display: flex; flex-direction: column; gap: 15px;
        }
        .footer-link { 
            color: var(--text-muted); text-decoration: none; padding: 12px; 
            border: 1px solid var(--border); border-radius: 8px; background: var(--card-bg); font-weight: 500;
            cursor: pointer;
        }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; padding: 20px; overflow-y: auto; }
        .modal-card { background: var(--card-bg); width: 100%; max-width: 400px; padding: 25px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .template-btn { width:100%; padding:15px; margin-bottom:10px; border:1px solid var(--border); border-radius:8px; background:var(--bg); text-align:left; cursor:pointer; color:var(--text); font-weight:bold; }
        .template-btn:hover { background:var(--hover-bg); border-color:var(--primary); }
        
        /* TOAST Notification */
        #toast {
            visibility: hidden; min-width: 250px; background-color: var(--text); color: var(--bg);
            text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 9999;
            left: 50%; bottom: 80px; transform: translateX(-50%); 
            font-weight: 500; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 80px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 80px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

    <div class="suite-header">
        <div class="header-top">
            <div class="header-info">
                <h1>üéì Lern-Suite V25.0</h1>
                <div class="streak-badge" onclick="initStreak()">
                    üî• <span id="streakCount">0</span> Tage
                </div>
            </div>
            
            <div class="header-controls-wrapper">
                <button class="btn-dark-mode" onclick="toggleDarkMode()">üåô</button>
                <div class="exam-control-group">
                    <div class="exam-controls">
                        <select id="examSelect" onchange="switchExam()"></select>
                        <button class="btn-exam-action" onclick="addExam()">+</button>
                        <button class="btn-exam-action" onclick="deleteExam()">üóëÔ∏è</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('cockpit')" id="tab-btn-cockpit">üöÄ Cockpit</button>
            <button class="tab-btn" onclick="switchTab('backlog')" id="tab-btn-backlog">üìã Katalog <span id="backlogCount" style="font-size:0.8em; opacity:0.7"></span></button>
            <button class="tab-btn" onclick="switchTab('howto')" id="tab-btn-howto">‚ÑπÔ∏è Info</button>
        </div>
    </div>

    <!-- TAB 1: COCKPIT -->
    <div id="tab-cockpit" class="tab-content active">
        <div class="phase-display" id="phaseDisplayBox">
            <span class="phase-badge" id="currentPhaseBadge">Lade...</span>
            <span style="float:right; font-weight:bold; color:var(--danger)">Noch <span id="daysLeft">0</span> Tage</span>
            <div style="margin-top:5px; font-size:0.9em; opacity:0.8" id="phaseFocus">...</div>
        </div>

        <button class="btn-magic" onclick="autoFillCockpit()">ü™Ñ Smart Auto-Fill (SRS)</button>

        <button class="adhoc-toggle" onclick="toggleAdhoc()">
            + Blitz-Aufgabe (Manuell)
        </button>

        <div class="input-card" id="adhocInput">
            <div class="form-group"><input type="text" id="inModul" placeholder="Modul (Tag, z.B. WiSo)"></div>
            <div class="form-group"><input type="text" id="inTask" placeholder="Aufgabe"></div>
            <div class="form-group">
                <select id="inImp">
                    <option value="10">Prio 10 (Extrem)</option>
                    <option value="8">Prio 8 (Hoch)</option>
                    <option value="5" selected>Prio 5 (Mittel)</option>
                    <option value="3">Prio 3 (Niedrig)</option>
                </select>
            </div>
            <div class="form-group"><input type="number" id="inTime" value="30" placeholder="Minuten"></div>
            <button class="btn-add" onclick="addCockpitTask()">Speichern</button>
        </div>

        <table class="task-table">
            <tbody id="cockpitTableBody"></tbody>
        </table>
        <div id="emptyCockpitMsg" style="text-align:center; padding:40px; color:var(--text-muted); display:none;">
            Nichts zu tun. <br>Dr√ºcke auf ü™Ñ Auto-Fill.
        </div>
    </div>


    <!-- TAB 2: BACKLOG (MIT TAG-FILTER) -->
    <div id="tab-backlog" class="tab-content">
        
        <div class="filter-row">
            <select id="filterExamPart" class="filter-select" onchange="renderWBS()">
                <option value="all">üìö Alle Pr√ºfungen</option>
            </select>
            <select id="filterModul" class="filter-select" onchange="renderWBS()">
                <option value="all">üåç Alle Themen</option>
            </select>
            <select id="filterLF" class="filter-select" onchange="renderWBS()">
                <option value="all">üè´ Alle Lernfelder</option>
            </select>
            <button class="wbs-btn" style="background:var(--primary); color:white; border:none; padding:0 15px; border-radius:8px;" onclick="addWbsRow()">+</button>
        </div>

        <table class="wbs-table">
            <tbody id="wbsTableBody"></tbody>
        </table>
        <div id="emptyBacklogMsg" style="text-align:center; padding:40px; display:none;">
            Leerer Katalog.<br>
            <button onclick="document.getElementById('importModal').style.display='flex'" style="margin-top:10px; padding:10px; background:var(--success); color:white; border:none; border-radius:8px; font-weight:bold;">üìã Daten Einf√ºgen (Copy/Paste)</button>
        </div>
    </div>

    <!-- TAB 3: INFO -->
    <div id="tab-howto" class="tab-content">
        <div style="background:var(--card-bg); padding:20px; border-radius:12px;">
            <h3>üöÄ Ultimate Lern-Suite V25.0</h3>
            <p><strong>IHK Full Integration</strong></p>
            <p><strong>Status:</strong> Die Daten aus deinem Katalog sind jetzt direkt im Code integriert!</p>
            <p>Falls du den Katalog nicht siehst:</p>
            <ol>
                <li>Klicke unten auf <strong>"üìö Katalog importieren"</strong>.</li>
                <li>W√§hle "AP1 Basis", "WiSo" usw.</li>
                <li>Der Button "üìã Daten Einf√ºgen" ist weiterhin da f√ºr alle F√§lle.</li>
            </ol>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer-tools">
        <a class="footer-link" onclick="openTemplateModal()" style="border-color:var(--success); color:var(--success); font-weight:bold;">üìö Katalog importieren (IHK FULL)</a>
        
        <a class="footer-link" onclick="openInstallModal()">üì≤ App Installieren (Info)</a>
        <a class="footer-link" onclick="downloadBackup()">üíæ Backup speichern</a>
        <a class="footer-link" onclick="restoreBackup()">üìÇ Backup laden</a>
        <a class="footer-link" style="color:var(--danger); border-color:var(--danger);" onclick="hardReset()">‚ö†Ô∏è Reset Alles</a>
        <input type="file" id="fileInput" style="display:none" onchange="handleFileSelect(event)">
    </div>

    <!-- MODALS -->
    <div id="installModal" class="modal-overlay">
        <div class="modal-card">
            <h3 style="margin-top:0">App installieren</h3>
            <p>F√ºr Vollbild ohne Browser-Leiste:</p>
            <ul><li>iOS: Teilen -> Home-Bildschirm</li><li>Android: Men√º -> App installieren</li></ul>
            <button onclick="document.getElementById('installModal').style.display='none'" style="width:100%; padding:10px; margin-top:10px;">Verstanden</button>
        </div>
    </div>

    <div id="templateModal" class="modal-overlay">
        <div class="modal-card">
            <h3 style="margin-top:0">üìö IHK Baukasten (Full)</h3>
            <p style="font-size:0.9em; color:var(--text-muted)">Daten aus deinem Upload sind bereit.</p>
            
            <button class="template-btn" style="border-left:5px solid #0052cc" onclick="loadIHKData('AP1')">
                üü¶ <strong>AP1 - BASIS (Alle Berufe)</strong><br>
                <small>Projekt, Hardware, Netze (LF 1, 2, 3, 5, 6)</small>
            </button>
            
            <button class="template-btn" style="border-left:5px solid #eab308" onclick="loadIHKData('WISO')">
                ‚öñÔ∏è <strong>WiSo (Komplett)</strong><br>
                <small>Recht, Sozialkunde, Betrieb (LF 1)</small>
            </button>

            <hr style="border:0; border-top:1px solid var(--border); margin:15px 0;">

            <button class="template-btn" style="border-left:5px solid #a855f7" onclick="loadIHKData('AP2')">
                üü™ <strong>AP2 - Komplett</strong><br>
                <small>Security, Datenschutz, Prozesse, Spezialisierung</small>
            </button>
            
            <button onclick="document.getElementById('templateModal').style.display='none'" style="width:100%; padding:10px; margin-top:10px;">Schlie√üen</button>
        </div>
    </div>

    <!-- PASTE IMPORT MODAL (Fallback) -->
    <div id="importModal" class="modal-overlay">
        <div class="modal-card" style="max-width:500px;">
            <h3 style="margin-top:0">üìã Daten Importieren</h3>
            <textarea id="pasteArea" style="width:100%; height:200px; padding:10px; border-radius:8px; border:1px solid var(--border); font-family:monospace; font-size:12px;" placeholder="Hier Text einf√ºgen..."></textarea>
            <div style="margin-top:10px; display:flex; gap:10px;">
                <button onclick="handlePasteImport()" style="flex:1; background:var(--success); color:white; border:none; padding:12px; border-radius:8px; font-weight:bold;">Import Starten</button>
                <button onclick="document.getElementById('importModal').style.display='none'" style="flex:1; background:var(--border); border:none; padding:12px; border-radius:8px;">Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast">Nachricht...</div>

    <script>
        // --- HARDCODED IHK DATA (COMPRESSED STRING TO SAVE SPACE) ---
        // Format: AP|Modul|Task|Lernfelder (Optional)
        // I have packed the CSV data you provided into this string block.
        const IHK_RAW_DATA = `
AP1|Projektmanagement|Merkmale eines Projektes|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Projektplanung mithilfe von Strukturplan, Netzplan und Gantt-Diagramm|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Kritischer Weg|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Pufferzeiten|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Fristgerechte Terminierung|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|L√∂sungen bei Terminproblemen|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|SMART-Prinzip|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Meilensteine|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Projektphasen (Wasserfall / SCRUM) definieren|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Phasen der Teambildung und -entwicklung kennen|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Reflexionsmethoden (Feedback-Kultur, Lessons Learned) kennen|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Machbarkeitsanalyse mithilfe einer Budgetvorgabe|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Vor- und Nachkalkulation|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Einfluss der Stakeholder beurteilen k√∂nnen|LF1, LF2, LF3, LF5, LF6
AP1|Projektmanagement|Risikoanalyse|LF1, LF2, LF3, LF5, LF6
AP1|Service & Support|Kundenkommunikation|LF1, LF2, LF3, LF5, LF6
AP1|Service & Support|Fehlermanagement|LF1, LF2, LF3, LF5, LF6
AP1|Service & Support|St√∂rungs-Management|LF1, LF2, LF3, LF5, LF6
AP1|Service & Support|Bearbeitungsstatus (z. B. Ticketsystem)|LF1, LF2, LF3, LF5, LF6
AP1|Service & Support|KI-Unterst√ºtzung|LF1, LF2, LF3, LF5, LF6
AP1|Service & Support|Support- und Serviceanfragen|LF1, LF2, LF3, LF5, LF6
AP1|Service & Support|First-, Second- und Third-Level-Support|LF1, LF2, LF3, LF5, LF6
AP1|Markt & Kunden|Marktformen (Monopol, Oligopol, Polypol, K√§ufer-/Verk√§ufermarkt)|LF1, LF2
AP1|Markt & Kunden|Zielgruppendefinition und -abgrenzung|LF1, LF2
AP1|Markt & Kunden|Quantitative und qualitative Angebotsbewertung|LF1, LF2
AP1|Markt & Kunden|Eigene Datenerhebung (z. B. Kundenbefragung)|LF1, LF2
AP1|Markt & Kunden|Auswertung vorhandener Daten (z. B. Anforderungen an B√ºroarbeitspl√§tze)|LF1, LF2
AP1|Markt & Kunden|Situationsgerechte Kundenkommunikation|LF1, LF2
AP1|Markt & Kunden|Kommunikationsmodelle (4-Ohren-Modell, Sender-Empf√§nger)|LF1, LF2
AP1|Markt & Kunden|Kundenbedarf ermitteln und Angebote unterbreiten|LF1, LF2
AP1|Markt & Kunden|Interpretation englischsprachiger Texte|LF1, LF2
AP1|Markt & Kunden|Technische und kaufm√§nnische Texte (deutsch/englisch)|LF1, LF2
AP1|Markt & Kunden|Pr√§sentation und Medienkompetenz|LF1, LF2
AP1|Markt & Kunden|Nutzwertanalyse|LF1, LF2
AP1|Markt & Kunden|Vertriebsformen (direkter/indirekter Vertrieb)|LF1, LF2
AP1|IT-Systeme|Funktionale, √∂konomische und √∂kologische Aspekte (Ergonomie, Kosten, Nutzungsdauer, Energie)|LF2, LF3
AP1|IT-Systeme|Hardwareprodukte (CPU, Motherboard, Speicher, Datentr√§ger, Netzteile, GPU, Peripherie, Sensoren, Netzwerkkarten, Router/Switch/AP)|LF2, LF3
AP1|IT-Systeme|Softwareprodukte (Anwendungen, Betriebssysteme, Standard-/Branchensoftware, DBMS, Browser, ERP/CRM/SCM, Entwicklungsumgebungen)|LF2, LF3
AP1|IT-Systeme|Cloudl√∂sungen (SaaS, DaaS)|LF2, LF3
AP1|IT-Systeme|KI-Software|LF2, LF3
AP1|IT-Systeme|Virtuelle Desktops (Cloud oder lokal)|LF2, LF3
AP1|IT-Systeme|Kommunikationssysteme (Videokonferenz, Social Media)|LF2, LF3
AP1|IT-Systeme|Client-Server-Systeme|LF2, LF3
AP1|IT-Systeme|Einbindung in einer Dom√§ne|LF2, LF3
AP1|IT-Systeme|Mobile Ger√§te (Smartphone, Tablet)|LF2, LF3
AP1|IT-Systeme|Netzwerkprotokolle (Ethernet, IP, DNS) und OSI-Modell|LF2, LF3
AP1|IT-Systeme|Kenngr√∂√üen, Leistungsdaten, Funktionsumfang|LF2, LF3
AP1|IT-Systeme|Einstellm√∂glichkeiten (BIOS/UEFI, CPU, RAM, SSD/HDD, Dateisysteme)|LF2, LF3
AP1|IT-Systeme|Grafik-/Netzwerkkarte, Gateway, Router, Switch, WLAN/Ethernet-Standards|LF2, LF3
AP1|IT-Systeme|Barrierefreier Zugriff am Arbeitsplatz|LF2, LF3
AP1|IT-Systeme|Einstellm√∂glichkeiten auf Webseiten|LF2, LF3
AP1|IT-Systeme|G√ºtesiegel f√ºr Energieeffizienz|LF2, LF3
AP1|IT-Systeme|√úbertragungsraten/zeiten, Datenmengen (Dokumente/Videos), Strom/Leistung/Wirkungsgrad/Energiekosten|LF2, LF3
AP1|IT-Systeme|Anschaffungs-/Betriebs-/Lizenz-/Finanzierungskosten, fixe/variable Kosten|LF2, LF3
AP1|IT-Systeme|Einfacher Kostenvergleich (Leasing, Kauf, Finanzierung, Pay-per-Use)|LF2, LF3
AP1|IT-Systeme|Preis-Leistungs-Verh√§ltnis|LF2, LF3
AP1|IT-Systeme|Qualitativer/quantitativer Angebotsvergleich|LF2, LF3
AP1|IT-Systeme|Wertsch√∂pfung|LF2, LF3
AP1|IT-L√∂sungen|Bedarfsanalyse|LF5
AP1|IT-L√∂sungen|Lasten- und Pflichtenheft (Zweck, Urheber, Inhalt)|LF5
AP1|IT-L√∂sungen|Installation/Einrichtung (OS, BIOS/UEFI, Partitionierungen/Formatierungen, Netzwerkanbindung, IPv4/v6, Remote-Desktop, KI-Software)|LF5
AP1|IT-L√∂sungen|Ger√§tekategorien (Desktop, Notebook, All-in-One, Thin Client, Tablet, Smartphone)|LF5
AP1|IT-L√∂sungen|Mobile/station√§re Arbeitsplatzsysteme (PC, Terminals, LAN, WLAN)|LF5
AP1|IT-L√∂sungen|Barrierefreiheit, Unterst√ºtzung durch zus√§tzliche Hardware (Monitor, Tastatur, Lautsprecher/Mikrofon)|LF5
AP1|IT-L√∂sungen|Anwendungssoftware|LF5
AP1|IT-L√∂sungen|Betriebssysteme (Einsatzzweck, Dateiverwaltung, Freigaben managen)|LF5
AP1|IT-L√∂sungen|Integrierte Entwicklungsumgebung (IDE)|LF5
AP1|IT-L√∂sungen|Standard- oder Individualsoftware|LF5
AP1|IT-L√∂sungen|Open Source / propriet√§r|LF5
AP1|IT-L√∂sungen|Beurteilungskriterien (Anpassbarkeit, Wartbarkeit, Schnittstellen)|LF5
AP1|IT-L√∂sungen|Grundlagen des Schutzes der Urheber|LF5
AP1|IT-L√∂sungen|Lizenzarten (EULA, OEM, GNU)|LF5
AP1|IT-L√∂sungen|Pay-per-Use|LF5
AP1|IT-L√∂sungen|Installation/Konfiguration Hardware|LF5
AP1|IT-L√∂sungen|Installation/Konfiguration Betriebssystem|LF5
AP1|IT-L√∂sungen|Arbeiten mit der Kommandozeile (Befehlssyntax, Parameter)|LF5
AP1|IT-L√∂sungen|Anpassung von Software|LF5
AP1|IT-L√∂sungen|Konfiguration, Test, Troubleshooting und Dokumentation von Netzwerkverbindungen (IP, DHCP, WLAN, VPN)|LF5
AP1|IT-L√∂sungen|Konsolenbefehle Datei/Netz (dir, ls, mkdir, ipconfig, ifconfig/ip, ping, traceroute, nslookup)|LF5
AP1|Programmierung|Compiler, Linker, Interpreter|LF5
AP1|Programmierung|Prozedurale und objektorientierte Herangehensweise|LF5
AP1|Programmierung|Variablen, Datentypen, Datenstrukturen|LF5
AP1|Programmierung|Kontrollstrukturen (Verzweigung, Schleife)|LF5
AP1|Programmierung|Prozeduren, Funktionen|LF5
AP1|Programmierung|Klassen, Attribute, Objekte, Methoden, Sichtbarkeit|LF5
AP1|Programmierung|Bibliotheken, Frameworks|LF5
AP1|Programmierung|Skriptsprachen (z. B. Shell)|LF5
AP1|Programmierung|Debugging, formale und inhaltliche Fehler|LF5
AP1|Programmierung|Kontrollstrukturen als Pseudocode abbilden|LF5
AP1|Programmierung|UML (Use Case, Klassen-, Aktivit√§tsdiagramm)|LF5
AP1|Programmierung|Entwurf von Ausgabemasken (Ergonomie, CI, Barrierefreiheit)|LF5
AP1|Programmierung|Fehler in gegebenem Quellcode finden|LF5
AP1|Programmierung|Schreibtischtest mit gegebenem Quellcode|LF5
AP1|Datenbanken|Einfache ER-Modelle|LF5
AP1|Qualit√§tssicherung|Betriebliche QM-Systeme|LF3, LF5, LF6
AP1|Qualit√§tssicherung|QS-Normen|LF3, LF5, LF6
AP1|Qualit√§tssicherung|Zertifizierung|LF3, LF5, LF6
AP1|Qualit√§tssicherung|Qualit√§tsplanung und Qualit√§tsziele (Ist-/Soll-Zustand)|LF3, LF5, LF6
AP1|Qualit√§tssicherung|Qualit√§tslenkung (Umsetzung der Planphase)|LF3, LF5, LF6
AP1|Qualit√§tssicherung|PDCA-Zyklus (Plan, Do, Check, Act)|LF3, LF5, LF6
AP1|Qualit√§tssicherung|Testprotokoll f√ºr das Einrichten eines Arbeitsplatzes|LF3, LF5, LF6
AP1|Sicherheit & Datenschutz|Verf√ºgbarkeit, Vertraulichkeit, Integrit√§t gew√§hrleisten|LF4
AP1|Sicherheit & Datenschutz|TOM; IT-Sicherheitsbeauftragte/r vs. Datenschutzbeauftragte/r|LF4
AP1|Sicherheit & Datenschutz|IT-Sicherheitsrichtlinien (z. B. Passwort-Policy)|LF4
AP1|Sicherheit & Datenschutz|Technische Ma√ünahmen (Virenschutz, Firewall, Verschl√ºsselung)|LF4
AP1|Sicherheit & Datenschutz|Personelle Ma√ünahmen, Sicherheitsbewusstsein|LF4
AP1|Sicherheit & Datenschutz|Ausschnitte BSI IT-Grundschutz|LF4
AP1|Sicherheit & Datenschutz|Grundz√ºge DSGVO/BDSG; personenbezogene Daten; Rechte; Anonymisierung/Pseudonymisierung|LF4
AP1|Sicherheit & Datenschutz|Schutzbedarf: Anwendungen, IT-Systeme, R√§ume/Infrastruktur, Kommunikationsverbindungen|LF4
AP1|Sicherheit & Datenschutz|Bausteine aus dem Grundschutzkatalog|LF4
AP1|Sicherheit & Datenschutz|Schutzbedarfskategorien (normal/hoch/sehr hoch) ableiten und begr√ºnden|LF4
AP1|Sicherheit & Datenschutz|Risikoklassifikation (z. B. Matrix)|LF4
AP1|Sicherheit & Datenschutz|ISMS kennen und unterst√ºtzen|LF4
AP1|Sicherheit & Datenschutz|Sicherheitsbewusstsein schaffen (Security by Design/Default)|LF4
AP1|Sicherheit & Datenschutz|IT-Sicherheitsmanagement|LF4
AP1|Sicherheit & Datenschutz|H√§rtung des Betriebssystems|LF4
AP1|Sicherheit & Datenschutz|Datensicherung / Backup-Verfahren|LF4
AP1|Sicherheit & Datenschutz|Sicherung der Verf√ºgbarkeit (z. B. NAS)|LF4
AP1|Sicherheit & Datenschutz|Zugangs- und Zugriffskontrolle|LF4
AP1|Sicherheit & Datenschutz|Verschl√ºsselung (symmetrisch, asymmetrisch, hybrid)|LF4
AP1|Sicherheit & Datenschutz|Hashwerte, Zertifikate, digitale Signaturen|LF4
AP1|Sicherheit & Datenschutz|Authentifizierung (z. B. Zwei-Faktor), Passwort-Policy bewerten|LF4
AP1|Sicherheit & Datenschutz|Personal Firewall anpassen|LF4
AP1|Vertragswesen|Kaufvertrag, Mietvertrag, Leasing|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Lizenzvertrag|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Servicevertrag, SLA|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Werkvertrag, Dienstvertrag|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Vertragsbestandteile (Leistungsbeschreibung, Termine, Entgelte, Sanktionen)|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Vertragsst√∂rungen|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Unternehmensziele (√ñkonomisch, √ñkologisch, Sozial)|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Leistungserbringung vor Ort vs. Remote|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Ticketsystem|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Kundenvorgaben (Termin/Ort, technische Voraussetzungen, Betriebssystem, Hersteller)|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Mehrliniensystem, Einliniensystem, Matrixorganisation|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Handlungs- und Entscheidungsspielr√§ume/Vollmachten|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Ver√§nderungsprozesse begleiten und unterst√ºtzen k√∂nnen|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Inhalt des Abnahmeprotokolls|LF2, LF3, LF6, LF7
AP1|Vertragswesen|M√§ngelarten: Schlechtleistung, Falschlieferung, Minderlieferung|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Soll-Ist-Vergleich, Abweichungsanalyse|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Nachkalkulation|LF2, LF3, LF6, LF7
AP1|Vertragswesen|Lessons Learned|LF2, LF3, LF6, LF7
AP2|Kundenbeziehungen|BGB / HGB|LF3, LF6, LF9, LF12
AP2|Kundenbeziehungen|Gesetz gegen unlauteren Wettbewerb (UWG)|LF3, LF6, LF9, LF12
AP2|Kundenbeziehungen|AGB-Gesetz|LF3, LF6, LF9, LF12
AP2|Kundenbeziehungen|Compliance|LF3, LF6, LF9, LF12
AP2|Kundenbeziehungen|Customer Relationship Management (CRM)|LF3, LF6, LF9, LF12
AP2|Kundenbeziehungen|Pr√§sentationstechnik|LF3, LF6, LF9, LF12
AP2|Kundenbeziehungen|Grafische Darstellung (Diagramme, Bildbearbeitung)|LF3, LF6, LF9, LF12
AP2|Kundenbeziehungen|Tabellenkalkulation|LF3, LF6, LF9, LF12
AP2|Kundenbeziehungen|Pr√§sentationsprogramme|LF3, LF6, LF9, LF12
AP2|Kundenbeziehungen|Corporate Identity (CI)|LF3, LF6, LF9, LF12
AP2|IT-Entwicklung|Debugging, Breakpoint|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|IT-Entwicklung|Software-Test (Black Box, White Box, Review, Extremwerttest)|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|IT-Entwicklung|Testdaten|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|IT-Entwicklung|Komponententest, Integrationstest, Systemtest|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|IT-Entwicklung|Versionsmanagement des Quellcodes|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|IT-Entwicklung|Algorithmen formulieren (Aktivit√§tsdiagramm, Pseudocode)|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|IT-Entwicklung|UML (Use Case, Klassen-, Aktivit√§tsdiagramme)|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|IT-Entwicklung|Entwurf der Bildschirmausgabemasken (Software-Ergonomie, Barrierefreiheit)|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|Datenbanken|Relationale und nicht-relationale Datenbanken, NoSQL|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|Datenbanken|Datentypen (Boolean, Integer, BLOB, etc.)|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|Datenbanken|Anomalien / Redundanzen erkennen|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|Datenbanken|Normalisieren (1. bis 3. Normalform)|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|Datenbanken|ER-Modell, Attribute, Beziehungen, Kardinalit√§ten, referenzielle Integrit√§t|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|Datenbanken|SQL: Tabellenstruktur, Index, Select, Sortieren, Gruppieren|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|Datenbanken|Abfrage √ºber mehrere Tabellen (Joins)|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|Datenbanken|Open Data, API-Schnittstellen|LF5, LF6, LF7, LF8, LF10, LF11, LF12
AP2|IT-Sicherheit|TCSEC, ITSEC, Common Criteria|LF4, LF5, LF9, LF11
AP2|IT-Sicherheit|BSI-Standards / IT-Grundschutz|LF4, LF5, LF9, LF11
AP2|IT-Sicherheit|ISO/IEC 2700x|LF4, LF5, LF9, LF11
AP2|IT-Sicherheit|Relevante rechtliche Vorschriften (GoBD, DSGVO)|LF4, LF5, LF9, LF11
AP2|IT-Sicherheit|Datensicherheitsmanagement|LF4, LF5, LF9, LF11
AP2|IT-Sicherheit|Datensicherungsstrategien (RAID, Vollsicherung, inkrementell, differentiell)|LF4, LF5, LF9, LF11
AP2|IT-Sicherheit|Verschl√ºsselung (Symmetrisch, asymmetrisch, hybrid; Hashwerte; Zertifikate; Digitale Signaturen)|LF4, LF5, LF9, LF11
AP2|IT-Sicherheit|Benutzer-, Gruppen- und Zugriffsrechte|LF4, LF5, LF9, LF11
AP2|IT-Sicherheit|Netzwerksicherheit; IDS- und IDP-Systeme|LF4, LF5, LF9, LF11
AP2|IT-Sicherheit|Social Engineering (Phishing, Deepfake)|LF4, LF5, LF9, LF11
AP2|Datenschutz|DSGVO, BDSG, E-Privacy, Urheberrecht, Recht am eigenen Bild|LF2, LF4, LF5, LF9, LF11, LF12
AP2|Datenschutz|Standard-Datenschutzmodell; ISO 27701, 27001|LF2, LF4, LF5, LF9, LF11, LF12
AP2|Datenschutz|Schutzbedarfsfeststellung (Daten klassifizieren, Schutzziele definieren)|LF2, LF4, LF5, LF9, LF11, LF12
AP2|Datenschutz|Datenschutzbeauftragte; BSI, T√úV; Datenschutzzertifizierung|LF2, LF4, LF5, LF9, LF11, LF12
AP2|Netzwerke|IPv4/IPv6, MAC, Routing, Switching, ARP, TCP/UDP|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Netzwerkkomponenten (Switch, Bridge, Router, Firewall)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Netzwerkkonzepte (LAN/WAN/MAN/GAN)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Zugriffskontrolle im Netzwerk (RADIUS, Kerberos)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Verschl√ºsselung auf Netzwerkebene, VPN|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|VLAN|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Drahtlos: PAN/WLAN/Mesh/Bluetooth|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Peer-to-Peer vs. Client-Server|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|√úbertragungsprotokolle (HTTP/HTTPS, TCP/UDP)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|VPN-Modelle (Tunneling, IPsec)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Dienste (DNS, DHCP, Proxy)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Server-Dienste (Mailserver, Webserver, Groupware, Datenbanken)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Ausfallwahrscheinlichkeiten (MTBF)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Notfallkonzept (Disaster Recovery)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Sicherstellung des Betriebes (USV, RAID, Backups)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Monitoring (SNMP, Systemlast, Schwellwerte)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Netzwerke|Incident Management (Ticketsystem, SLA, Eskalation)|LF3, LF4, LF5, LF6, LF7, LF8, LF9, LF11
AP2|Speicher|NAS, SAN, iSCSI, SMB, NFS|LF4, LF5, LF8, LF9
AP2|Speicher|Backup-Strategien (On-Premises, Cloud, SaaS, IaaS)|LF4, LF5, LF8, LF9
AP2|Konzeption|Schutzziele der Informationssicherheit (Integrit√§t, Verf√ºgbarkeit)|LF2, LF4, LF5, LF7, LF8, LF9, LF10, LF12
AP2|Konzeption|Cloud vs. On-Premises|LF2, LF4, LF5, LF7, LF8, LF9, LF10, LF12
AP2|Konzeption|Virtualisierung vs. Bare-Metal|LF2, LF4, LF5, LF7, LF8, LF9, LF10, LF12
AP2|Konzeption|Server Hardware/OS/Anwendungen|LF2, LF4, LF5, LF7, LF8, LF9, LF10, LF12
AP2|Konzeption|Cloud-Anbieter Auswahl|LF2, LF4, LF5, LF7, LF8, LF9, LF10, LF12
AP2|Konzeption|Kompatibilit√§tsprobleme (Zeichens√§tze, Formate)|LF2, LF4, LF5, LF7, LF8, LF9, LF10, LF12
AP2|Konzeption|Lifecycle-Betrachtung (Support, Updates)|LF2, LF4, LF5, LF7, LF8, LF9, LF10, LF12
AP2|Konzeption|Tests (Performance, Penetration, Integration, System)|LF2, LF4, LF5, LF7, LF8, LF9, LF10, LF12
AP2|Konzeption|Migration planen|LF2, LF4, LF5, LF7, LF8, LF9, LF10, LF12
WISO|Ausbildung|Inhalte des Ausbildungsvertrages|
WISO|Ausbildung|Rechte und Pflichten Azubi/Ausbilder|
WISO|Ausbildung|Probezeit, Verg√ºtung, Urlaub, K√ºndigung|
WISO|Ausbildung|Duales System (Vorteile/Lernorte)|
WISO|Ausbildung|Aufgaben Kammern/Betrieb/Schule|
WISO|Recht|Arbeitsrechtliche Gesetze (BBiG, ArbSchG)|
WISO|Recht|Arbeitgeberverb√§nde/Gewerkschaften|
WISO|Recht|Betriebsrat (Wahl, Rechte)|
WISO|Recht|JAV (Jugend-Auszubildendenvertretung)|
WISO|Recht|Tarifrecht (Vertr√§ge, Autonomie, Arbeitskampf)|
WISO|Lohn|Lohnformen, Brutto/Netto, Lohnsteuer|
WISO|Lohn|Sozialversicherungen|
WISO|Betrieb|Rechtsformen (GmbH, KG, AG)|
WISO|Betrieb|Unternehmensstrukturen (Matrix, Sparte)|
WISO|Betrieb|Wirtschaftliche Verflechtungen (Konzern)|
WISO|Schutz|Arbeitsschutzgesetz, Arbeitssicherheitsgesetz|
WISO|Schutz|Unfallverh√ºtungsvorschriften (UVV)|
WISO|Schutz|Bildschirmarbeitsplatzverordnung|
WISO|Schutz|Gef√§hrdungen am Arbeitsplatz|
WISO|Schutz|Erste-Hilfe-Ma√ünahmen, Meldeketten|
WISO|Schutz|Brandschutz|
WISO|Umwelt|Rationelle Energieverwendung|
WISO|Umwelt|Abfalltrennung und Recycling|
WISO|Digital|Vernetztes Zusammenarbeiten|
WISO|Digital|Datenschutz bei Kommunikation|
WISO|Digital|Ethische Aspekte und Compliance|
`;

        // --- DATA ---
        let exams = [], activeExamId = null, cockpitTasks = [], wbsData = [];

        function initApp() {
            try {
                exams = JSON.parse(localStorage.getItem('exams')) || [];
                activeExamId = localStorage.getItem('activeExamId');
                cockpitTasks = JSON.parse(localStorage.getItem('cockpitTasks')) || [];
                wbsData = JSON.parse(localStorage.getItem('wbsData')) || [];

                if(exams.length === 0) {
                    const id = 'def-'+Date.now();
                    exams.push({id, name:'Meine IHK Pr√ºfung', date:'', startDate: new Date().toISOString().split('T')[0]});
                    activeExamId = id;
                    saveAll();
                } else if(!activeExamId) activeExamId = exams[0].id;

                wbsData.forEach(t => { 
                    if(!t.id) t.id = Date.now()+Math.random(); 
                    if(t.decayFlag===undefined) t.decayFlag=false;
                    if(t.level===undefined) t.level = (t.status === 'done') ? 1 : 0;
                    if(!t.lf) t.lf = []; 
                    if(!t.examPart) t.examPart = "IHK";
                });

                initStreak();
                applyDecay();
                renderAll();
                if(localStorage.getItem('darkMode')==='on') document.body.classList.add('dark-mode');
            } catch(e) { console.log(e); }
        }

        function saveAll() {
            localStorage.setItem('exams', JSON.stringify(exams));
            localStorage.setItem('activeExamId', activeExamId);
            localStorage.setItem('cockpitTasks', JSON.stringify(cockpitTasks));
            localStorage.setItem('wbsData', JSON.stringify(wbsData));
        }

        function renderAll() { renderHeader(); renderCockpit(); renderWBS(); }

        // --- SRS LOGIC ---
        function getInterval(level) {
            if(level === 0) return 1; 
            if(level === 1) return 3;  
            if(level === 2) return 7;  
            if(level === 3) return 14; 
            if(level >= 4) return 30;  
            return 3;
        }

        function getDaysDiff(d) {
            if(!d) return 999;
            return Math.floor(Math.abs(new Date() - new Date(d)) / (864e5));
        }

        function applyDecay() {
            let changed = false;
            wbsData.forEach(t => {
                if(t.examId !== activeExamId) return;
                const diff = getDaysDiff(t.lastReviewed);
                const limit = getInterval(t.level);

                if(t.status==='done' && diff > limit) { 
                    t.status='doing'; t.decayFlag=true; changed=true; 
                }
                if(t.status!=='todo' && diff > (limit * 2.5)) { 
                    t.status='todo'; t.decayFlag=true; changed=true; 
                }
            });
            if(changed) saveAll();
        }

        function calcScore(imp, min, decay, status, level) {
            if(status === 'done') return 0;
            let s = (parseInt(imp||5) * 10);
            if(parseInt(min||60) <= 30) s += 5;
            if(decay) s += 20;
            if(level > 0 && decay) s += (level * 5); 
            return s;
        }

        // --- HELPER ---
        function showToast(msg) {
            const t = document.getElementById("toast");
            t.className = "show"; t.innerText = msg;
            setTimeout(function(){ t.className = t.className.replace("show", ""); }, 3000);
        }

        // --- HEADER ---
        function renderHeader() {
            const sel = document.getElementById('examSelect');
            sel.innerHTML = "";
            exams.forEach(e => {
                let d = e.date ? ` (${e.date.split('-').reverse().join('.')})` : "";
                sel.innerHTML += `<option value="${e.id}" ${e.id===activeExamId?'selected':''}>${e.name}${d}</option>`;
            });
            
            const ex = exams.find(e=>e.id===activeExamId);
            const daysLeft = ex && ex.date ? Math.ceil((new Date(ex.date) - new Date())/864e5) : "?";
            document.getElementById('daysLeft').innerText = daysLeft;
            const badge = document.getElementById('currentPhaseBadge');
            if(daysLeft > 42) badge.innerText = "1. VERSTEHEN"; else if(daysLeft > 7) badge.innerText = "3. ABRUF"; else badge.innerText = "4. TRANSFER";
        }

        function addExam() {
            const n = prompt("Name:"); if(!n) return;
            const dInput = prompt("Datum (TT.MM.YYYY):");
            let iso = "";
            if(dInput) { const p = dInput.split('.'); if(p.length===3) iso = `${p[2]}-${p[1]}-${p[0]}`; }
            exams.push({ id: 'ex'+Date.now(), name: n, date: iso, startDate: new Date().toISOString().split('T')[0] });
            activeExamId = exams[exams.length-1].id;
            saveAll(); renderAll();
        }
        function deleteExam() { if(exams.length>1 && confirm("L√∂schen?")) { exams = exams.filter(e=>e.id!==activeExamId); activeExamId=exams[0].id; saveAll(); renderAll(); } }
        function switchExam() { activeExamId = document.getElementById('examSelect').value; saveAll(); renderAll(); }
        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); localStorage.setItem('darkMode', document.body.classList.contains('dark-mode')?'on':'off'); }
        function switchTab(name) { document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active')); document.getElementById('tab-'+name).classList.add('active'); document.getElementById('tab-btn-'+name).classList.add('active'); }

        // --- COCKPIT ---
        function autoFillCockpit() {
            const pool = wbsData.filter(t => t.examId === activeExamId && t.status !== 'done' && !cockpitTasks.some(ct => ct.originId === t.id));
            if(pool.length === 0) return alert("Alles erledigt!");
            pool.sort((a,b) => calcScore(b.imp, b.time, b.decayFlag, b.status, b.level) - calcScore(a.imp, a.time, a.decayFlag, a.status, a.level));
            pool.slice(0, 3).forEach(src => {
                cockpitTasks.push({ id: Date.now() + Math.random(), originId: src.id, examId: activeExamId, modul: src.mod, task: src.task, imp: src.imp, time: src.time, done: false, score: calcScore(src.imp, src.time, src.decayFlag, src.status, src.level) });
                src.status = 'doing';
            });
            saveAll(); renderAll();
        }

        function addCockpitTask() {
            const m = document.getElementById('inModul').value, t = document.getElementById('inTask').value;
            if(!t) return;
            cockpitTasks.push({ id: Date.now(), examId: activeExamId, modul: m, task: t, imp: document.getElementById('inImp').value, time: document.getElementById('inTime').value, done: false, score: 50 });
            saveAll(); renderCockpit(); toggleAdhoc(); document.getElementById('inTask').value="";
        }

        function renderCockpit() {
            const tb = document.getElementById('cockpitTableBody'); tb.innerHTML = "";
            const ts = cockpitTasks.filter(t => t.examId === activeExamId);
            ts.sort((a,b) => a.done===b.done ? b.score-a.score : a.done?1:-1);
            if(ts.length===0) document.getElementById('emptyCockpitMsg').style.display='block'; else document.getElementById('emptyCockpitMsg').style.display='none';
            ts.forEach(t => {
                const row = document.createElement('tr'); if(t.done) row.className = 'task-done';
                row.innerHTML = `<td><div style="font-weight:bold;color:var(--primary)">${t.modul||'-'}</div><div style="font-size:1.1em">${t.task}</div><div style="font-size:0.85em;color:var(--text-muted)">‚è± ${t.time}m ‚ö° ${t.imp} üèÜ ${t.score}</div></td><td style="text-align:right"><button class="btn-check ${t.done?'checked':''}" onclick="toggleDone(${t.id})">‚úî</button> ${!t.done ? `<button onclick="delTask(${t.id})" style="background:none;border:none;font-size:1.2rem;opacity:0.5;">üóëÔ∏è</button>` : ''}</td>`;
                tb.appendChild(row);
            });
        }

        function toggleDone(id) {
            const t = cockpitTasks.find(x => x.id === id);
            if(t) {
                t.done = !t.done;
                if(t.originId) {
                    const master = wbsData.find(w => w.id === t.originId);
                    if(master) {
                        if(t.done) {
                            master.status = 'done';
                            master.lastReviewed = new Date().toISOString().split('T')[0];
                            master.decayFlag = false;
                            master.level = (master.level || 0) + 1; // SRS LEVEL UP
                            
                            // TOAST MESSAGE
                            const nextInterval = getInterval(master.level);
                            showToast(`üëç Super! Level ${master.level} erreicht.\nWiedervorlage in ${nextInterval} Tagen.`);
                        } else {
                            master.status = 'doing';
                        }
                        saveAll(); renderWBS();
                    }
                }
                saveAll(); renderCockpit();
                if(t.done) setTimeout(() => { cockpitTasks = cockpitTasks.filter(x => x.id !== id); saveAll(); renderCockpit(); }, 800);
            }
        }
        function delTask(id) { if(confirm("L√∂schen?")) { cockpitTasks = cockpitTasks.filter(x=>x.id!==id); saveAll(); renderCockpit(); } }
        function toggleAdhoc() { document.getElementById('adhocInput').classList.toggle('open'); }

        // --- BACKLOG ---
        function renderWBS() {
            const tb = document.getElementById('wbsTableBody'); tb.innerHTML = "";
            let ds = wbsData.filter(t => t.examId === activeExamId);

            // Update Counter
            const countEl = document.getElementById('backlogCount');
            if(countEl) countEl.innerText = `(${ds.length})`;

            // Populate Filters
            populateFilters(ds);
            
            // Apply Filters
            const filterExam = document.getElementById('filterExamPart').value;
            const filterMod = document.getElementById('filterModul').value;
            const filterLF = document.getElementById('filterLF').value;

            if(filterExam !== 'all') ds = ds.filter(t => t.examPart === filterExam);
            if(filterMod !== 'all') ds = ds.filter(t => t.mod === filterMod);
            if(filterLF !== 'all') ds = ds.filter(t => t.lf && t.lf.includes(filterLF));

            if(ds.length===0) document.getElementById('emptyBacklogMsg').style.display='block'; else document.getElementById('emptyBacklogMsg').style.display='none';

            ds.forEach((r, idx) => {
                const globalIdx = wbsData.indexOf(r);
                const score = calcScore(r.imp, r.time, r.decayFlag, r.status, r.level);
                
                // Badges
                let badges = "";
                if(r.examPart) badges += `<span class="ap-badge">${r.examPart}</span>`;
                if(r.lf && r.lf.length > 0) {
                    r.lf.forEach(l => badges += `<span class="lf-badge">${l}</span>`);
                }

                // DOTS
                let dots = "";
                for(let i=0; i<4; i++) dots += (i < r.level) ? "‚óè" : "‚óã";
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td data-label="Modul"><input value="${r.mod}" oninput="updWBS(${globalIdx},'mod',this.value)" placeholder="Modul"></td>
                    <td data-label="Thema">
                        <input value="${r.task}" oninput="updWBS(${globalIdx},'task',this.value)" onkeydown="checkEnter(event,${globalIdx})" placeholder="Thema">
                        <div style="margin-top:5px;">${badges}</div>
                    </td>
                    <td data-label="Details"><div style="display:flex;gap:5px;width:100%"><input type="number" value="${r.time}" oninput="updWBS(${globalIdx},'time',this.value)" style="width:50%"><select onchange="updWBS(${globalIdx},'imp',this.value)" style="width:50%"><option value="10" ${r.imp=='10'?'selected':''}>Prio 10</option><option value="5" ${r.imp=='5'?'selected':''}>Prio 5</option><option value="3" ${r.imp=='3'?'selected':''}>Prio 3</option></select></div></td>
                    <td data-label="Status">
                        <div style="display:flex; align-items:center; justify-content:flex-end; gap:10px; width:100%;">
                            <select class="status-select" onchange="updStatus(${globalIdx},this.value)" style="background:${getStatusColor(r.status)}; color:#000;">
                                <option value="todo" ${r.status=='todo'?'selected':''}>üî¥ Offen</option>
                                <option value="doing" ${r.status=='doing'?'selected':''}>üü° Doing</option>
                                <option value="done" ${r.status=='done'?'selected':''}>üü¢ Sitzt</option>
                            </select>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <span class="level-dots" title="Level ${r.level}">${dots}</span>
                                <span class="score-badge">${score} Pkt</span>
                            </div>
                        </div>
                    </td>
                    <td class="action-cell"><button class="wbs-btn" onclick="pushToCockpit(${globalIdx})">üöÄ</button><button class="wbs-btn" style="color:red;margin-left:10px;" onclick="delWBS(${globalIdx})">√ó</button></td>
                `;
                tb.appendChild(row);
            });
        }

        function populateFilters(data) {
            const selExam = document.getElementById('filterExamPart');
            const selMod = document.getElementById('filterModul');
            const selLF = document.getElementById('filterLF');
            
            const currExam = selExam.value;
            const currMod = selMod.value;
            const currLF = selLF.value;

            const exams = [...new Set(data.map(i => i.examPart || 'Sonstiges'))].sort();
            const mods = [...new Set(data.map(i => i.mod))].sort();
            const lfs = [...new Set(data.flatMap(i => i.lf || []))].sort();

            selExam.innerHTML = '<option value="all">üìö Alle Pr√ºfungen</option>';
            exams.forEach(e => selExam.innerHTML += `<option value="${e}" ${e===currExam?'selected':''}>${e}</option>`);

            selMod.innerHTML = '<option value="all">üåç Alle Themen</option>';
            mods.forEach(m => selMod.innerHTML += `<option value="${m}" ${m===currMod?'selected':''}>${m}</option>`);

            selLF.innerHTML = '<option value="all">üè´ Alle Lernfelder</option>';
            lfs.forEach(l => {
                selLF.innerHTML += `<option value="${l}" ${l===currLF?'selected':''}>${l}</option>`;
            });
        }

        function getStatusColor(s) { if(s==='done') return '#dcfce7'; if(s==='doing') return '#fef3c7'; return '#fee2e2'; }
        function updWBS(idx, f, v) { wbsData[idx][f] = v; saveAll(); }
        function updStatus(idx, val) { 
            const task = wbsData[idx];
            task.status = val; 
            if(val==='done') { 
                task.lastReviewed = new Date().toISOString().split('T')[0]; task.decayFlag=false; 
                task.level = (task.level || 0) + 1;
                showToast(`üëç Manuell gelernt! Level ${task.level} erreicht.`);
            } else if (val === 'todo') {
                if(confirm("Hast du das Thema vergessen? Level wird auf 0 zur√ºckgesetzt.")) {
                    task.level = 0;
                }
            }
            saveAll(); renderWBS(); 
        }
        function addWbsRow() { wbsData.push({ id:Date.now()+Math.random(), examId:activeExamId, mod:"", task:"", time:"30", imp:"5", status:"todo", level:0, lf:[], examPart:"Sonstiges" }); saveAll(); renderWBS(); }
        function checkEnter(e, idx) { if(e.key==='Enter') { wbsData.splice(idx+1, 0, { id:Date.now()+Math.random(), examId:activeExamId, mod:wbsData[idx].mod, task:"", time:"30", imp:"5", status:"todo", level:0, lf:[], examPart:"Sonstiges" }); saveAll(); renderWBS(); } }
        function delWBS(idx) { if(confirm("L√∂schen?")) { wbsData.splice(idx,1); saveAll(); renderWBS(); } }
        function pushToCockpit(idx) { const r = wbsData[idx]; if(cockpitTasks.some(c=>c.originId===r.id)) return alert("Schon drin!"); cockpitTasks.push({ id:Date.now(), originId:r.id, examId:activeExamId, modul:r.mod, task:r.task, imp:r.imp, time:r.time, done:false, score:calcScore(r.imp,r.time,r.decayFlag,'doing', r.level) }); r.status='doing'; saveAll(); renderAll(); }
        function sortBacklogByScore() { wbsData.sort((a,b) => calcScore(b.imp,b.time,b.decayFlag,b.status,b.level) - calcScore(a.imp,a.time,a.decayFlag,a.status,a.level)); saveAll(); renderWBS(); }

        // --- PASTE IMPORT FUNCTIONALITY (V23.0) ---
        function handlePasteImport() {
            const rawText = document.getElementById('pasteArea').value;
            if(!rawText || rawText.trim().length === 0) return alert("Bitte Text einf√ºgen!");

            const lines = rawText.split(/\r\n|\n/);
            
            // Detect Separator: Check first line
            let sep = ';';
            if (lines[0].includes('\t')) sep = '\t'; // Excel copy support

            let count = 0;
            let skipped = 0;

            for(let i=0; i<lines.length; i++) {
                const line = lines[i];
                if(!line || line.trim()==="") continue;
                
                // Use robust parser
                const cols = parseCSVLine(line, sep);
                
                // IHK Structure Check (7 cols usually)
                if(cols.length < 6) continue;

                // Mapping based on your structure
                // 0: Pr√ºfungsteil, 3: Themenkreis, 4: Unterpunkt, 5: LF, 6: Typ
                const examPart = cols[0] ? cols[0].trim() : "Sonstiges";
                const mod = cols[3] ? cols[3].trim() : "Allgemein";
                const task = cols[4] ? cols[4].trim() : "";
                const lfStr = cols[5] ? cols[5].trim() : "";
                const type = cols[6] ? cols[6].trim() : "";

                // Skip Header or non-tasks
                if(examPart.toLowerCase().includes("pr√ºfungsteil")) continue;
                
                // IMPORTANT: Filter only "Unterpunkt"
                if(!type.toLowerCase().includes("unterpunkt")) {
                    skipped++;
                    continue;
                }
                
                if(!task) continue;

                // Duplicate Check
                const exists = wbsData.some(existing => existing.examId === activeExamId && existing.task === task);
                if(exists) continue;

                // Parse LF
                let lfs = [];
                if(lfStr) {
                    lfs = lfStr.replace(/"/g, '').split(',').map(s => s.trim()).filter(s => s.startsWith('LF'));
                }

                wbsData.push({
                    id: Date.now() + Math.random(),
                    examId: activeExamId,
                    mod: mod, 
                    task: task, 
                    time: "30", 
                    imp: "5",   
                    status: 'todo',
                    level: 0,
                    decayFlag: false,
                    lf: lfs,
                    examPart: examPart
                });
                count++;
            }

            saveAll();
            renderAll();
            document.getElementById('importModal').style.display = 'none';
            document.getElementById('pasteArea').value = ""; // Clear
            alert(`${count} Aufgaben erfolgreich importiert!\n(${skipped} √úberschriften √ºbersprungen)`);
        }

        // Helper: Parses CSV line respecting quotes
        function parseCSVLine(text, separator) {
            const res = [];
            let current = '';
            let inQuote = false;
            for(let i=0; i<text.length; i++) {
                const char = text[i];
                if(char === '"') {
                    inQuote = !inQuote;
                } else if(char === separator && !inQuote) {
                    res.push(current.trim().replace(/^"|"$/g, '')); 
                    current = '';
                } else {
                    current += char;
                }
            }
            res.push(current.trim().replace(/^"|"$/g, ''));
            return res;
        }

        // --- IHK DATA LOADER (COMPRESSED) ---
        function loadIHKData(filterPart) {
            if(!confirm("Katalog '" + filterPart + "' importieren?")) return;
            
            const lines = IHK_RAW_DATA.trim().split('\n');
            let added = 0;

            lines.forEach(line => {
                const [part, mod, task, lfStr] = line.split('|');
                
                // Filter by Exam Part (AP1, AP2, WISO) or load all if empty
                if(filterPart && part !== filterPart && filterPart !== 'AP2' && filterPart !== 'AP1') {
                    // Special logic for AP2 parts if needed, but for now simple filter
                    if(!part.includes(filterPart)) return;
                }
                
                // For AP2 button, load AP2
                if(filterPart === 'AP2' && !part.startsWith('AP2')) return;
                if(filterPart === 'AP1' && !part.startsWith('AP1')) return;
                if(filterPart === 'WISO' && !part.startsWith('WISO')) return;

                const exists = wbsData.some(e => e.examId === activeExamId && e.task === task);
                if(exists) return;

                let lfs = lfStr ? lfStr.split(',').map(s => s.trim()) : [];

                wbsData.push({
                    id: Date.now() + Math.random(),
                    examId: activeExamId,
                    mod: mod,
                    task: task,
                    time: "30",
                    imp: "5",
                    status: "todo",
                    level: 0,
                    decayFlag: false,
                    lf: lfs,
                    examPart: part
                });
                added++;
            });

            saveAll();
            renderAll();
            document.getElementById('templateModal').style.display='none';
            showToast(`${added} Aufgaben aus ${filterPart} geladen.`);
        }

        // --- EXTRAS ---
        function initStreak() {
            const today = new Date().toISOString().split('T')[0];
            let s = JSON.parse(localStorage.getItem('streakData')) || { count: 0, lastLogin: null };
            if(s.lastLogin !== today) {
                const yest = new Date(); yest.setDate(yest.getDate()-1);
                if(s.lastLogin === yest.toISOString().split('T')[0]) s.count++; else s.count = 1;
                s.lastLogin = today; localStorage.setItem('streakData', JSON.stringify(s));
            }
            document.getElementById('streakCount').innerText = s.count;
        }
        function openTemplateModal() { document.getElementById('templateModal').style.display='flex'; }
        
        function openInstallModal() { document.getElementById('installModal').style.display='flex'; }
        function hardReset() { if(confirm("‚ö†Ô∏è Alles l√∂schen?")) { localStorage.clear(); location.reload(); } }
        function downloadBackup() { const d={exams,activeExamId,cockpitTasks,wbsData,streak:JSON.parse(localStorage.getItem('streakData'))}; const b=new Blob([JSON.stringify(d)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='backup.json'; a.click(); }
        function restoreBackup() { document.getElementById('fileInput').click(); }
        function handleFileSelect(e) { const fr=new FileReader(); fr.onload=(ev)=>{ const d=JSON.parse(ev.target.result); localStorage.setItem('exams',JSON.stringify(d.exams)); localStorage.setItem('activeExamId',d.activeExamId); localStorage.setItem('wbsData',JSON.stringify(d.wbsData)); localStorage.setItem('cockpitTasks',JSON.stringify(d.cockpitTasks)); location.reload(); }; fr.readAsText(e.target.files[0]); }

        window.onload = initApp;
    </script>
</body>
</html>
